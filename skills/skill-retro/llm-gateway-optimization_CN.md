# 技能：llm-gateway-optimization (LLM 网关优化)

- **名称**: `llm-gateway-optimization`
- **描述**: 用于 LLM 网关的高级性能优化，包括动态路由、语义缓存增强和自适应保护。
- **触发词**: ["优化网关路由", "增强缓存准确度", "实现自适应限流", "实现 EWMA"]

## 核心工作流

1. **动态路由 (EWMA)**: 放弃静态权重，使用指数加权移动平均（EWMA）实时计算各节点的成功率与延迟权重：$W = \text{BaseWeight} \times \frac{\text{SuccessRate}^2}{\text{Latency}}$。
2. **语义缓存重排序 (Re-ranking)**: 在向量检索（初筛）后，增加基于字符串相似度（如 Jaccard）或小模型的二次精筛，降低幻觉命中。
3. **自适应并发限流 (Adaptive Limiting)**: 监测 RTT 抖动，利用梯度算法动态调节并发窗口，防止上游过载导致的雪崩。

## 决策启发式
- 当上游 Provider 性能不稳定（429 频发或延迟抖动）时，优先开启 EWMA。
- 当用户反馈语义缓存命中不准时，开启 Re-ranking 并设置阈值（建议 0.8）。
- 在生产环境高并发接入时，必须配置 Adaptive Limiter 作为系统底线。

## 验收标准
- 路由能自动规避延迟高、失败率高的节点。
- 语义缓存命中准确度显著提升。
- 系统在高压下并发上限能动态收缩。
